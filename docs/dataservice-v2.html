<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>DataService v2 - Docs</title>
    <link rel="stylesheet" href="https://canary-development.github.io/css/open-source/main-style.css">

    <style>
        hr {
            margin-top: 2em;
            margin-bottom: 2em;
        }
    </style>
</head>

<body class="padded">
    <p class="title bold margin-bottom">DataService v2 Documentation</p>
    <p class="description medium">DataService v2 is a data storing module that relies on ProfileService under
        the hood, which includes many features such as session locking. The goal of this module is to allow developers
        to skip the part of making a profile manager and be able to jump right in.</p>
    <hr>
    <p class="heading semibold">Table of Contents</p>
    <ul>
        <li><a href="#intro" class="no-decor link-hover">Introduction</a></li>
        <li><a href="#usage" class="no-decor link-hover">Basic Usage</a></li>
        <li><a href="#api" class="no-decor link-hover">API Reference</a>
            <ul>
                <li><a href="#api" class="no-decor link-hover">Functions</a></li>
                <li><a href="#api-signals" class="no-decor link-hover">Script Signals</a></li>
            </ul>
        </li>
    </ul>
    <hr>
    <p id="intro" class="heading semibold">Introduction</p>
    <p class="margin">DataService v2 is a package developed by Canary. It saves data as you may have expected from the
        title, and uses the well-known <code>ProfileService</code> behind the scenes. To get started, simply require the
        module and get your DataStore, providing the name and the default data.<br><br>You may have asked, why use
        DataService? Well here are a few reasons why:
    <ul>
        <li>It's simple and easy to learn</li>
        <li>The API is similar to the regular data storing API</li>
        <li>It uses <code>ProfileService</code>, one of the best known data saving modules at this time.</li>
    </ul>
    There are a few more reasons, but they will not be discussed here for simplicity.
    </p>
    <hr>
    <p id="usage" class="heading semibold">Basic Usage</p>
    <p class="margin">As stated before, the API of DataService is very similar to Roblox's own
        <code>DataStoreService</code> API. Below is a code sample that you are welcome to copy to set yourself up.
    </p>
    <div class="dark padded margin">
        <pre>
            <code>
                local DataService = require(game:GetService("ServerStorage").DataService)
                local MyDataStore = DataService.CreateDataStore("MyDataStore", {
                    Gems = 5;
                    Cash = 100;
                })
                
                -- Get the data store, and provide the data template
                
                local Players = game:GetService("Players")
                
                MyDataStore.SessionLockClaimed:Connect(function(player)
                    print(`{player.Name}'s session lock has been claimed.`)
                end)
                
                MyDataStore.SessionLockUnclaimed:Connect(function(player)
                    print(`{player.Name}'s session lock has been unlclaimed.`)
                end)
                
                Players.PlayerAdded:Connect(function(player)
                    local PlayerData = MyDataStore:LoadDataAsync(player) -- Load the joining player's data
                    
                    local leaderstats = Instance.new("Folder")
                    
                    leaderstats.Name = "leaderstats"
                    leaderstats.Parent = player
                    
                    local Cash = Instance.new("NumberValue")
                    
                    Cash.Name = "Cash"
                    Cash.Value = PlayerData:GetKey("Cash") -- Get the player's 'Cash' key
                    Cash.Parent = leaderstats
                    
                    local Gems = Instance.new("NumberValue")
                    
                    Gems.Name = "Gems"
                    Gems.Value = PlayerData:GetKey("Gems") -- Get the player's 'Gems' key
                    Gems.Parent = leaderstats
                end)
                
                Players.PlayerRemoving:Connect(function(player)
                    MyDataStore:UnclaimSessionLock(player, {
                        Cash = player.leaderstats.Cash.Value;
                        Gems = player.leaderstats.Gems.Value;
                    }) -- Unclaim the player's session lock on leave, and save their values
                end)
            </code>
        </pre>
    </div>
    <hr>
    <p id="api" class="heading semibold">API Reference</p>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">Package.CreateDataStore(name, defaultData)</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Creates a DataStore object, similar to <code>DataStoreService:GetDataStore()</code></p>
        <p class="margin">Params:</p>
        <ul>
            <li class="margin"><b>name: string</b><br>The name of the <code>DataStore</code> to get.</li>
            <li class="margin"><b>defaultData: dictionary?</b><br>A dictionary of default data to provide.</li>
        </ul>
        <p class="margin-top">Returns:</p>
        <ul>
            <li><b>DataStoreObject: Object</b></li>
        </ul>
    </div>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">DataStoreObject:GetLoadedPlayers()</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Returns an array of loaded players in the current <code>DataStore</code>.</p>
        <p class="margin">Params:</p>
        <ul>
            <li class="margin">None</li>
        </ul>
        <p class="margin-top">Returns:</p>
        <ul>
            <li><b>LoadedPlayers: {Player}</b></li>
        </ul>
    </div>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">DataStoreObject:RemoveDataAsync(userId)</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Completely wipes data off of a key associated with the provided <code>UserId</code>.</p>
        <p class="margin">Params:</p>
        <ul>
            <li class="margin"><b>userId: number</b><br>The <code>UserId</code> of the player to remove data from.</li>
        </ul>
        <p class="margin-top">Returns:</p>
        <ul>
            <li><b>void</b></li>
        </ul>
    </div>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">DataStoreObject:GetDataAsync(userId)</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Gets the data of the player with the provided <code>UserId</code>.</p>
        <p class="margin">Params:</p>
        <ul>
            <li class="margin"><b>userId: number</b><br>The <code>UserId</code> of the player to fetch data from.</li>
        </ul>
        <p class="margin-top">Returns:</p>
        <ul>
            <li><b>PlayerData: dictionary?</b></li>
        </ul>
    </div>
    <div class="dark padded margin">
        <p style="color: rgb(255, 232, 61)"><code
                style="font-size: 1.5em">DataStoreObject:LoadDataAsync(player, reconcileData, claimedHandler)</code>
            YIELDS!</p>
        <p class="margin">Description:</p>
        <p class="margin bold">Loads the data from the provided player, they must be in the running server.</p>
        <p class="margin">Params:</p>
        <ul>
            <li class="margin"><b>player: Player</b><br>The player in the running game that data should be loaded from.
            </li>
            <li class="margin"><b>reconcileData: boolean?</b><br>A boolean deciding if the data should be reconciled.
            </li>
            <li class="margin"><b>claimedHandler: (placeId: number, gameJobId: string) -> () | "ForceLoad" |
                    "Cancel"</b><br>A boolean deciding if the data should be reconciled.</li>
        </ul>
        <p class="margin-top">Returns:</p>
        <ul>
            <li><b>PlayerData: dictionary?</b></li>
        </ul>
    </div>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">DataStoreObject:UnclaimSessionLock(player, valuesToSave)</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Releases the session lock of the provided player. Has an optional
            <code>valuesToSave</code> param which is useful for when you store your data in attributes.</p>
        <p class="margin">Params:</p>
        <ul>
            <li class="margin"><b>player: Player</b><br>The player to unclaim the session lock for.</li>
            <li class="margin"><b>valuesToSave: dictionary?</b><br>Any values to save existing keys to. Below is an
                example of usage:</li>
            <code>DataStoreObject:UnclaimSessionLock(player, {Cash = player.leaderstats.Cash.Value, Wins = player.leaderstats.Wins.Value})</code>
        </ul>
        <p class="margin-top">Returns:</p>
        <ul>
            <li><b>void</b></li>
        </ul>
    </div>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">DataStoreObject:SetGlobalKeyAsync(userId, key, value)</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Sets a global key which is sent to the provided <code>UserId</code>.</p>
        <p class="margin">Params:</p>
        <ul>
            <li class="margin"><b>userId: number</b><br>The player with the <code>UserId</code> which should recieve the
                <code>GlobalKey</code>.</li>
            <li class="margin"><b>key: string</b><br>The type of <code>GlobalKey</code> is being sent. Can be checked to
                see what the key actually is for.</li>
            <li class="margin"><b>value: any</b><br>Data that should be assigned to the <code>GlobalKey</code>.</li>
        </ul>
        <p class="margin-top">Returns:</p>
        <ul>
            <li><b>void</b></li>
        </ul>
    </div>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">PlayerDataObject:SetKey(key, value)</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Sets the <code>key</code> key to the provided value.</p>
        <p class="margin">Params:</p>
        <ul>
            <li class="margin"><b>key: string</b><br>The key to assign data to.</li>
            <li class="margin"><b>value: any</b><br>The value of <code>key</code>.</li>
        </ul>
        <p class="margin-top">Returns:</p>
        <ul>
            <li><b>void</b></li>
        </ul>
    </div>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">PlayerDataObject:GetKey(key)</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Gets the provided key's value.</p>
        <p class="margin">Params:</p>
        <ul>
            <li class="margin"><b>key: string</b><br>The key to get data from.</li>
        </ul>
        <p class="margin-top">Returns:</p>
        <ul>
            <li><b>value: any?</b></li>
        </ul>
    </div>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">PlayerDataObject:GetGlobalKeys()</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Gets a dictionary of <code>GlobalKeys</code> that have been sent to the player.</p>
        <p class="margin">Params:</p>
        <ul>
            <li class="margin">None</li>
        </ul>
        <p class="margin-top">Returns:</p>
        <ul>
            <li><b>GlobalKeys: {[key: string]: value}</b></li>
        </ul>
    </div>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">PlayerDataObject:RemoveKey(key)</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Removes the provided key.</p>
        <p class="margin">Params:</p>
        <ul>
            <li class="margin"><b>key: string</b><br>The key to remove from the player's data.</li>
        </ul>
        <p class="margin-top">Returns:</p>
        <ul>
            <li><b>void</b></li>
        </ul>
    </div>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">PlayerDataObject:GetKeyChangedSignal(key)</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Gets a signal that is fired whenever <code>key</code> changes.</p>
        <p class="margin">Params:</p>
        <ul>
            <li class="margin"><b>key: string</b><br>The key to monitor and fire a signal when it changes.</li>
        </ul>
        <p class="margin-top">Returns:</p>
        <ul>
            <li><b>KeyChangedSignal: ScriptSignal</b></li>
        </ul>
    </div>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">PlayerDataObject:GetMetaData()</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Gets metadata about the player's data.</p>
        <p class="margin">Params:</p>
        <ul>
            <li class="margin">None</li>
        </ul>
        <p class="margin-top">Returns:</p>
        <ul>
            <li><b>PlayerMetaData: {DataCreated: number, DataLoadCount: number}</b></li>
        </ul>
    </div>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">PlayerDataObject:GetSessionMetaData()</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Gets metadata about the player's current session.</p>
        <p class="margin">Params:</p>
        <ul>
            <li class="margin">None</li>
        </ul>
        <p class="margin-top">Returns:</p>
        <ul>
            <li><b>SessionMetaData: {Name: string, LoadedAt: number, Key: string}</b></li>
        </ul>
    </div>
    <hr>
    <p id="api-signals" class="heading semibold margin">Script Signals</p>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">DataStoreObject.SessionLockClaimed</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Fires when a session lock is claimed for a player.</p>
        <p class="margin">Arguments:</p>
        <ul>
            <li class="margin"><b>player: Player</b><br>The player that had their session lock claimed.</li>
        </ul>
    </div>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">DataStoreObject.SessionLockUnclaimed</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Fires when a session lock is unclaimed for a player.</p>
        <p class="margin">Arguments:</p>
        <ul>
            <li class="margin"><b>player: Player</b><br>The player that had their session lock unclaimed.</li>
        </ul>
    </div>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">PlayerDataObject.KeyChanged</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Fires when a key is changed.</p>
        <p class="margin">Arguments:</p>
        <ul>
            <li class="margin"><b>key: string</b><br>The key that was changed.</li>
            <li class="margin"><b>value: any</b><br>The new value of the key that was changed.</li>
        </ul>
    </div>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">PlayerDataObject.KeyAdded</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Fires when a new key is added.</p>
        <p class="margin">Arguments:</p>
        <ul>
            <li class="margin"><b>key: string</b><br>The name of the key that was added.</li>
            <li class="margin"><b>value: any</b><br>The value of the new key that was added.</li>
        </ul>
    </div>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">PlayerDataObject.KeyRemoved</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Fires when a key is removed.</p>
        <p class="margin">Arguments:</p>
        <ul>
            <li class="margin"><b>key: string</b><br>The name of the key that was removed.</li>
        </ul>
    </div>
    <div class="dark padded margin">
        <code style="font-size: 1.5em">PlayerDataObject.GlobalKeyAdded</code>
        <p class="margin">Description:</p>
        <p class="margin bold">Fires when a <code>GlobalKey</code> is added.</p>
        <p class="margin">Arguments:</p>
        <ul>
            <li class="margin"><b>key: string</b><br>The name of the global key that was added.</li>
            <li class="margin"><b>value: any</b><br>The value of the new global key.</li>
        </ul>
    </div>
</body>

</html>
</body>

</html>
